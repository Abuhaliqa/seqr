"use strict";(self.webpackChunkseqr=self.webpackChunkseqr||[]).push([[180],{44449:(e,t,r)=>{r.r(t),r.d(t,{drag:()=>n.oh,dragDisable:()=>n.Kn,dragEnable:()=>n.eF,cluster:()=>i.ki,hierarchy:()=>i.bT,pack:()=>i.P2,packEnclose:()=>i.O1,packSiblings:()=>i.jA,partition:()=>i.uK,stratify:()=>i.QP,tree:()=>i.G_,treemap:()=>i.pN,treemapBinary:()=>i.wL,treemapDice:()=>i.LQ,treemapResquarify:()=>i.eA,treemapSlice:()=>i.Km,treemapSliceDice:()=>i.E_,treemapSquarify:()=>i.o$,arc:()=>a.Nb,area:()=>a.SO,areaRadial:()=>a.am,curveBasis:()=>a.$0,curveBasisClosed:()=>a.Dt,curveBasisOpen:()=>a.WQ,curveBundle:()=>a.tF,curveCardinal:()=>a.YY,curveCardinalClosed:()=>a.Ov,curveCardinalOpen:()=>a.dC,curveCatmullRom:()=>a.zg,curveCatmullRomClosed:()=>a.fG,curveCatmullRomOpen:()=>a.$m,curveLinear:()=>a.c_,curveLinearClosed:()=>a.fx,curveMonotoneX:()=>a.Fd,curveMonotoneY:()=>a.ak,curveNatural:()=>a.Sx,curveStep:()=>a.eA,curveStepAfter:()=>a.js,curveStepBefore:()=>a.iJ,line:()=>a.jv,lineRadial:()=>a.XB,linkHorizontal:()=>a.h5,linkRadial:()=>a.M4,linkVertical:()=>a.rR,pie:()=>a.ve,pointRadial:()=>a.Hs,radialArea:()=>a.N1,radialLine:()=>a.aJ,stack:()=>a.kn,stackOffsetDiverging:()=>a.W$,stackOffsetExpand:()=>a.pB,stackOffsetNone:()=>a.HL,stackOffsetSilhouette:()=>a.Ku,stackOffsetWiggle:()=>a.YG,stackOrderAppearance:()=>a.mG,stackOrderAscending:()=>a.$K,stackOrderDescending:()=>a.IX,stackOrderInsideOut:()=>a.FP,stackOrderNone:()=>a.Qx,stackOrderReverse:()=>a.cY,symbol:()=>a.NA,symbolCircle:()=>a.JF,symbolCross:()=>a.tJ,symbolDiamond:()=>a.rZ,symbolSquare:()=>a.m_,symbolStar:()=>a.Hm,symbolTriangle:()=>a.P6,symbolWye:()=>a.n3,symbols:()=>a.uH,clientPoint:()=>o.Eb,create:()=>o.Ue,creator:()=>o.Du,customEvent:()=>o._H,event:()=>o.B,local:()=>o.I_,matcher:()=>o.C2,mouse:()=>o.Jz,namespace:()=>o.uD,namespaces:()=>o.aC,select:()=>o.Ys,selectAll:()=>o.td,selection:()=>o.f_,selector:()=>o.nZ,selectorAll:()=>o.UK,style:()=>o.oB,touch:()=>o.Fq,touches:()=>o.W4,window:()=>o.u9,zoom:()=>l.sP,zoomIdentity:()=>l.CR,zoomTransform:()=>l.P2});var n=r(37345),i=r(47367),a=r(60508),o=r(56164),l=r(66842)},16028:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ye});var n=r(92437),i=r(66318),a=r.n(i),o=r(75216),l=r(18063),c=r(19804),u=r(15161),s=r(53417),d=r(38396),f=r(10527),m=r(56327),p=r(85516),y=r(91843),b=r(769),g=r(75234),v=r(93755),h=r(51084),O=r(87109),P=r(20738),S=r(26493),E=r(75041),I=r(31722),w=r(77178),j=r(97853),k=r(22322),_=r(62699),D=r(66211);function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},T(e,t)}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var G=n.lazy((function(){return Promise.all([r.e(190),r.e(557)]).then(r.bind(r,32639))})),z=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return A(e)}(this,x(t).call(this,e)),F(A(r),"state",{error:null}),F(A(r),"onFinished",(function(e){var t=r.props.onSuccess;return 200===e.status?t(JSON.parse(e.response),r.modalId):r.setState({error:"Error: ".concat(e.statusText," (").concat(e.status,")")})})),r.modalId="uploadPedigree-".concat(e.family.familyGuid),r}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,e),r=t,(i=[{key:"render",value:function(){var e=this.props.family,t=this.state.error;return n.createElement(S.Z,{title:"Upload Pedigree for Family ".concat(e.familyId),modalName:this.modalId,trigger:n.createElement(E.ZP,{content:"Upload New Image",icon:"upload",labelPosition:"right"})},n.createElement(n.Suspense,{fallback:n.createElement(I.Z,null)},n.createElement(G,{onUploadFinished:this.onFinished,url:"/api/family/".concat(e.familyGuid,"/update_pedigree_image"),clearTimeOut:0,auto:!0,maxFiles:1,dropzoneLabel:"Drag and drop or click to upload pedigree image"})),t&&n.createElement(w.Z,{error:!0,content:t}))}}])&&C(r.prototype,i),a&&C(r,a),t}(n.PureComponent);F(z,"propTypes",{family:a().object,onSuccess:a().func});var N=(0,o.$j)(null,(function(e){return{onSuccess:function(t,r){e({type:k.Yt,updatesById:{familiesByGuid:t}}),e((0,g.Mr)(r))}}}))(z),B=n.memo((function(e){var t=e.onSubmit,r=e.onSuccess;return n.createElement(_.Z,{onSubmit:t,onSuccess:r,confirmDialog:"Are you sure you want to delete the pedigree image for this family?",buttonText:"Delete Pedigree Image"})}));B.propTypes={onSubmit:a().func,onSuccess:a().func};var R=(0,o.$j)(null,(function(e,t){return{onSubmit:function(){return e((0,j.S)({familyField:"pedigree_image",familyGuid:t.familyGuid}))},onSuccess:function(){return e((0,g.Mr)(t.modalId))}}}))(B),Y=n.memo((function(e){var t=e.onSubmit,r=e.onSuccess;return n.createElement(D.Z,{onSubmit:t,onSuccess:r,icon:"save",size:"huge",confirmDialog:"Are you sure you want to save this pedigree?"})}));Y.propTypes={onSubmit:a().func,onSuccess:a().func};var H=(0,o.$j)(null,(function(e,t){return{onSubmit:function(){return e((0,j.S)({pedigreeDataset:t.getPedigreeDataset(),familyGuid:t.familyGuid}))},onSuccess:function(){return e((0,g.Mr)(t.modalId))}}}))(Y),M=r(6939);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function L(){return L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},L.apply(this,arguments)}function $(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,a=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw i}}return a}(e,t)||re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},K(e)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){ee(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e){return function(e){if(Array.isArray(e))return ne(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||re(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){if(e){if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ne(e,t):void 0}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ie=d.ZP.img.attrs({alt:"pedigree"}).withConfig({displayName:"LazyPedigreeImagePanel__PedigreeImg"})(["max-height:","px;max-width:225px;vertical-align:top;cursor:",";"],(function(e){return e.maxHeight}),(function(e){return e.disablePedigreeZoom?"auto":"zoom-in"})),ae=(0,d.ZP)(E.S_).withConfig({displayName:"LazyPedigreeImagePanel__PedigreeJsContainer"})(["display:",";cursor:",";i.fa{cursor:pointer;}@font-face{font-family:'ped-icon-overrides';src:url(\"/static/fonts/icon-overrides.eot\");src:url(\"/static/fonts/icon-overrides.eot?#iefix\") format('embedded-opentype'),url(\"/static/fonts/icon-overrides.woff\") format('woff'),url(\"/static/fonts/icon-overrides.ttf\") format('truetype'),url(\"/static/fonts/icon-overrides.svg#icons\") format('svg');}.addchild,.addsibling,.addpartner,.addparents,.delete,.settings,.popup_selection{font-family:Icons !important;cursor:pointer;&.fa-circle,&.fa-square,&.fa-unspecified{font-family:ped-icon-overrides !important;}}"],(function(e){return e.disablePedigreeZoom&&e.isEditable?"auto":"none"}),(function(e){return e.disablePedigreeZoom?"auto":"zoom-in"})),oe="editPedIndividual",le=[{name:"label",label:"Individual ID"},{name:"affected",label:"Affected?",component:P.JV,fullHeight:!0,asFormInput:!0},X({name:v.Sk,label:"Sex"},v.HO[v.Sk].formFieldProps),{name:"yob",label:"Birth Year",component:P.p6,width:6},{name:"status",label:"Living?",component:P.Ee,options:[{value:0,text:"Alive"},{value:1,text:"Deceased"}]}].concat(te(["adopted_in","adopted_out","miscarriage","termination"].map((function(e){return{name:e,label:(0,h._e)(e),component:P.a1,inline:!0}})))),ce={name:"individualGuid",label:"displayName",sex:"sex",affected:"affected",yob:"birthYear",mother:"maternalGuid",father:"paternalGuid",status:"deathYear"},ue={background:"#fff",diseases:[],labels:["label","age"],zoomIn:3,zoomOut:3,zoomSrc:["button"]},se=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return V(e)}(this,K(t).call(this,e)),ee(V(r),"state",{}),ee(V(r),"setContainerElement",(function(e){r.container=e})),ee(V(r),"redrawPedigree",(function(e,t){e.dataset=(0,y.KY)(r.yobToAge(t||e.dataset));try{(0,p.ZR)(e)}catch(e){throw(0,y.sY)("Error",e.message),e}return(0,p.VU)(e),e})),ee(V(r),"setPedigreeImage",(function(e){var t=M(r.container.children[0]);(0,f.PI)(t,"pedigree",{resolution:10}).done((function(t){var n=t.img;r.setState({pedigreeOpts:e,imgSrc:n})}))})),ee(V(r),"unsetPedigreeImage",(function(){r.setState({imgSrc:null})})),ee(V(r),"isEditablePedigree",(function(){var e=r.props,t=e.disablePedigreeZoom,n=e.isEditable;return t&&n})),ee(V(r),"getFamilyDataset",(function(){var e=r.props,t=e.family,n=e.individuals,i=t.pedigreeDataset||(n||[]).map((function(e){return Object.entries(ce).reduce((function(t,r){var n=U(r,2),i=n[0],a=n[1],o=e[a];if("affected"===i)o=o===v.H5;else if("status"===i)o=o||0===o?1:0;else if(!o&&("mother"===i||"father"===i))return t;return X({},t,ee({},i,o))}),{})})).map((function(e){return e.mother||e.father?e:X({},e,{top_level:!0})})),a={};return i.filter((function(e){var t=e.mother,r=e.father;return t&&!r||!t&&r})).forEach((function(e){var t="".concat(e.mother||e.father,"-spouse-placeholder");a[t]||(a[t]={name:t,sex:e.mother?"M":"F",top_level:!0}),e.mother?e.father=t:e.mother=t})),r.yobToAge([].concat(te(i),te(Object.values(a))))})),ee(V(r),"yobToAge",(function(e){return e.map((function(e){return X({},e,{age:e.yob&&(new Date).getFullYear()-e.yob})}))})),ee(V(r),"editIndividual",(function(e,t){var n=t.data,i=r.props.openIndividualModal;r.setState({editIndividual:{data:n,save:function(t){Object.assign(n,t),r.redrawPedigree(e)}}}),i()})),ee(V(r),"getPedigreeDataset",(function(){var e=r.state.pedigreeOpts;return(0,m.Vk)(e)})),r.containerId="pedigreeJS-".concat(e.family.familyGuid),r}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,e),r=t,(i=[{key:"componentDidMount",value:function(){this.props.family.pedigreeImage||this.drawPedigree()}},{key:"componentDidUpdate",value:function(e,t){var r=this.props,n=r.family,i=r.individuals,a=this.state,o=a.imgSrc,l=a.pedigreeOpts;if(!n.pedigreeImage&&(e.family.pedigreeImage||e.family.pedigreeDataset!==n.pedigreeDataset||e.individuals!==i&&!n.pedigreeDataset||t.imgSrc&&!o))if(o)this.unsetPedigreeImage();else{var c=this.redrawPedigree(l,this.getFamilyDataset());this.isEditablePedigree()||this.setPedigreeImage(c)}}},{key:"drawPedigree",value:function(){var e=this.getFamilyDataset(),t=X({dataset:this.getFamilyDataset(),targetDiv:this.containerId,btn_target:"".concat(this.containerId,"-buttons"),edit:this.editIndividual,font_size:e.length<6?"1.3em":".8em",symbol_size:e.length<6?60:40},ue),r=(0,p.J_)(t);this.isEditablePedigree()?(M(".fa-refresh").remove(),this.setState({pedigreeOpts:r})):this.setPedigreeImage(r)}},{key:"render",value:function(){var e=this.props,t=e.family,r=e.modalId,i=$(e,["family","modalId"]),a=this.state,o=a.imgSrc,l=a.editIndividual,u=void 0===l?{}:l,s=t.pedigreeImage||o;return s?n.createElement(ie,L({src:s},i)):n.createElement(ae,i,n.createElement(E._N,{basic:"very",compact:"very"},n.createElement(c.Z.Body,null,n.createElement(c.Z.Row,null,n.createElement(c.Z.Cell,null,n.createElement("div",{id:"".concat(this.containerId,"-buttons")})),n.createElement(c.Z.Cell,{collapsing:!0},n.createElement(H,{modalId:r,familyGuid:t.familyGuid,getPedigreeDataset:this.getPedigreeDataset}))))),n.createElement("div",{ref:this.setContainerElement,id:this.containerId}),n.createElement(S.Z,{title:(u.data||{}).label,modalName:oe},n.createElement(O.ZP,{onSubmit:u.save,form:oe,initialValues:u.data,fields:le,submitButtonText:"Update",confirmCloseIfNotSaved:!0})))}}])&&q(r.prototype,i),a&&q(r,a),t}(n.PureComponent);ee(se,"propTypes",{family:a().object,disablePedigreeZoom:a().bool,isEditable:a().bool,individuals:a().arrayOf(a().object),openIndividualModal:a().func,modalId:a().string});var de=(0,o.$j)((function(e,t){return{individuals:(0,b.ae)(e)[t.family.familyGuid]}}),(function(e){return{openIndividualModal:function(){e((0,g.h7)(oe))}}}))(se),fe=function(){return n.createElement(u.Z,{name:"picture"})},me=function(e){return n.createElement(l.ErrorBoundary,{FallbackComponent:fe},n.createElement(de,e))},pe=n.memo((function(e){var t=e.family,r=e.isEditable,i=e.disablePedigreeZoom,a=t.pedigreeImage||t.pedigreeDataset||t.individualGuids.length>1;if(!a&&!r)return null;var o=a&&n.createElement(me,{family:t,disablePedigreeZoom:i,maxHeight:"150"});if(i)return o;var l="Pedigree-".concat(t.familyGuid);return n.createElement(S.Z,{modalName:l,title:"Family ".concat(t.displayName),trigger:o||n.createElement(E.ZP,{content:"Edit Pedigree Image",icon:"edit"})},n.createElement(s.Z,{basic:!0,textAlign:"center"},n.createElement(me,{family:t,disablePedigreeZoom:!0,isEditable:r,modalId:l,maxHeight:"250"}),n.createElement("br",null)),n.createElement(E._N,{basic:"very",compact:"very",collapsing:!0},n.createElement(c.Z.Body,null,n.createElement(c.Z.Row,null,t.pedigreeImage&&n.createElement(c.Z.Cell,null,n.createElement("a",{key:"zoom",href:t.pedigreeImage,target:"_blank",rel:"noreferrer"},"Original Size",n.createElement(u.Z,{name:"zoom"}))),r&&n.createElement(c.Z.Cell,null,n.createElement(N,{key:"upload",family:t})),r&&t.pedigreeImage&&n.createElement(c.Z.Cell,null,n.createElement(R,{familyGuid:t.familyGuid,modalId:l}))))))}));pe.propTypes={family:a().object.isRequired,disablePedigreeZoom:a().bool,isEditable:a().bool};const ye=pe}}]);