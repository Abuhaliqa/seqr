"use strict";(self.webpackChunkseqr=self.webpackChunkseqr||[]).push([[881],{14827:function(t,e,n){n.d(e,{Z:function(){return i},D:function(){return a}});var s=n(5130),o=n(12828);function i(t){var e=t.document.documentElement,n=(0,s.Z)(t).on("dragstart.drag",o.Z,!0);"onselectstart"in e?n.on("selectstart.drag",o.Z,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function a(t,e){var n=t.document.documentElement,i=(0,s.Z)(t).on("dragstart.drag",null);e&&(i.on("click.drag",o.Z,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}},12828:function(t,e,n){n.d(e,{r:function(){return o},Z:function(){return i}});var s=n(42274);function o(){s.B.stopImmediatePropagation()}function i(){s.B.preventDefault(),s.B.stopImmediatePropagation()}},52508:function(t,e){var n=Math.PI,s=2*n,o=1e-6,i=s-o;function a(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function r(){return new a}a.prototype=r.prototype={constructor:a,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,s){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+s)},bezierCurveTo:function(t,e,n,s,o,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +s+","+(this._x1=+o)+","+(this._y1=+i)},arcTo:function(t,e,s,i,a){t=+t,e=+e,s=+s,i=+i,a=+a;var r=this._x1,l=this._y1,u=s-t,c=i-e,h=r-t,p=l-e,d=h*h+p*p;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(d>o)if(Math.abs(p*u-c*h)>o&&a){var f=s-r,g=i-l,v=u*u+c*c,b=f*f+g*g,x=Math.sqrt(v),m=Math.sqrt(d),y=a*Math.tan((n-Math.acos((v+d-b)/(2*x*m)))/2),w=y/m,$=y/x;Math.abs(w-1)>o&&(this._+="L"+(t+w*h)+","+(e+w*p)),this._+="A"+a+","+a+",0,0,"+ +(p*f>h*g)+","+(this._x1=t+$*u)+","+(this._y1=e+$*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,a,r,l,u){t=+t,e=+e,u=!!u;var c=(a=+a)*Math.cos(r),h=a*Math.sin(r),p=t+c,d=e+h,f=1^u,g=u?r-l:l-r;if(a<0)throw new Error("negative radius: "+a);null===this._x1?this._+="M"+p+","+d:(Math.abs(this._x1-p)>o||Math.abs(this._y1-d)>o)&&(this._+="L"+p+","+d),a&&(g<0&&(g=g%s+s),g>i?this._+="A"+a+","+a+",0,1,"+f+","+(t-c)+","+(e-h)+"A"+a+","+a+",0,1,"+f+","+(this._x1=p)+","+(this._y1=d):g>o&&(this._+="A"+a+","+a+",0,"+ +(g>=n)+","+f+","+(this._x1=t+a*Math.cos(l))+","+(this._y1=e+a*Math.sin(l))))},rect:function(t,e,n,s){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +s+"h"+-n+"Z"},toString:function(){return this._}},e.Z=r},69607:function(t,e,n){n.d(e,{Z:function(){return i}});var s=n(98861),o=n(47882);function i(t){var e=(0,s.Z)();return e.changedTouches&&(e=e.changedTouches[0]),(0,o.Z)(t,e)}},47882:function(t,e,n){function s(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,[(s=s.matrixTransform(t.getScreenCTM().inverse())).x,s.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}n.d(e,{Z:function(){return s}})},56070:function(t,e,n){n.d(e,{Z:function(){return o}});var s=n(73078);function o(t){return"string"==typeof t?new s.Y1([document.querySelectorAll(t)],[document.documentElement]):new s.Y1([null==t?[]:t],s.Jz)}},98861:function(t,e,n){n.d(e,{Z:function(){return o}});var s=n(42274);function o(){for(var t,e=s.B;t=e.sourceEvent;)e=t;return e}},92992:function(t,e,n){n.d(e,{Z:function(){return i}});var s=n(98861),o=n(47882);function i(t,e,n){arguments.length<3&&(n=e,e=(0,s.Z)().changedTouches);for(var i,a=0,r=e?e.length:0;a<r;++a)if((i=e[a]).identifier===n)return(0,o.Z)(t,i);return null}},45902:function(t,e,n){n.d(e,{Z:function(){return l}});var s=n(52508),o=n(56297),i=n(41545),a=n(23780),r=n(32337);function l(){var t=r.x,e=null,n=(0,o.Z)(0),l=r.y,u=(0,o.Z)(!0),c=null,h=i.Z,p=null;function d(o){var i,a,r,d,f,g=o.length,v=!1,b=new Array(g),x=new Array(g);for(null==c&&(p=h(f=(0,s.Z)())),i=0;i<=g;++i){if(!(i<g&&u(d=o[i],i,o))===v)if(v=!v)a=i,p.areaStart(),p.lineStart();else{for(p.lineEnd(),p.lineStart(),r=i-1;r>=a;--r)p.point(b[r],x[r]);p.lineEnd(),p.areaEnd()}v&&(b[i]=+t(d,i,o),x[i]=+n(d,i,o),p.point(e?+e(d,i,o):b[i],l?+l(d,i,o):x[i]))}if(f)return p=null,f+""||null}function f(){return(0,a.Z)().defined(u).curve(h).context(c)}return d.x=function(n){return arguments.length?(t="function"==typeof n?n:(0,o.Z)(+n),e=null,d):t},d.x0=function(e){return arguments.length?(t="function"==typeof e?e:(0,o.Z)(+e),d):t},d.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:(0,o.Z)(+t),d):e},d.y=function(t){return arguments.length?(n="function"==typeof t?t:(0,o.Z)(+t),l=null,d):n},d.y0=function(t){return arguments.length?(n="function"==typeof t?t:(0,o.Z)(+t),d):n},d.y1=function(t){return arguments.length?(l=null==t?null:"function"==typeof t?t:(0,o.Z)(+t),d):l},d.lineX0=d.lineY0=function(){return f().x(t).y(n)},d.lineY1=function(){return f().x(t).y(l)},d.lineX1=function(){return f().x(e).y(n)},d.defined=function(t){return arguments.length?(u="function"==typeof t?t:(0,o.Z)(!!t),d):u},d.curve=function(t){return arguments.length?(h=t,null!=c&&(p=h(c)),d):h},d.context=function(t){return arguments.length?(null==t?c=p=null:p=h(c=t),d):c},d}},56297:function(t,e,n){function s(t){return function(){return t}}n.d(e,{Z:function(){return s}})},41545:function(t,e,n){function s(t){this._context=t}function o(t){return new s(t)}n.d(e,{Z:function(){return o}}),s.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}}},23780:function(t,e,n){n.d(e,{Z:function(){return r}});var s=n(52508),o=n(56297),i=n(41545),a=n(32337);function r(){var t=a.x,e=a.y,n=(0,o.Z)(!0),r=null,l=i.Z,u=null;function c(o){var i,a,c,h=o.length,p=!1;for(null==r&&(u=l(c=(0,s.Z)())),i=0;i<=h;++i)!(i<h&&n(a=o[i],i,o))===p&&((p=!p)?u.lineStart():u.lineEnd()),p&&u.point(+t(a,i,o),+e(a,i,o));if(c)return u=null,c+""||null}return c.x=function(e){return arguments.length?(t="function"==typeof e?e:(0,o.Z)(+e),c):t},c.y=function(t){return arguments.length?(e="function"==typeof t?t:(0,o.Z)(+t),c):e},c.defined=function(t){return arguments.length?(n="function"==typeof t?t:(0,o.Z)(!!t),c):n},c.curve=function(t){return arguments.length?(l=t,null!=r&&(u=l(r)),c):l},c.context=function(t){return arguments.length?(null==t?r=u=null:u=l(r=t),c):r},c}},32337:function(t,e,n){function s(t){return t[0]}function o(t){return t[1]}n.d(e,{x:function(){return s},y:function(){return o}})},27881:function(t,e,n){function s(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function o(t,e){return fetch(t,e).then(s)}n.d(e,{u:function(){return bt}});var i=n(65351),a=n(56070),r=n(5130);var l=n(6939);var u="$";function c(){}function h(t,e){var n=new c;if(t instanceof c)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var s,o=-1,i=t.length;if(null==e)for(;++o<i;)n.set(o,t[o]);else for(;++o<i;)n.set(e(s=t[o],o,t),s)}else if(t)for(var a in t)n.set(a,t[a]);return n}c.prototype=h.prototype={constructor:c,has:function(t){return u+t in this},get:function(t){return this[u+t]},set:function(t,e){return this[u+t]=e,this},remove:function(t){var e=u+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===u&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===u&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===u&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===u&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===u&&++t;return t},empty:function(){for(var t in this)if(t[0]===u)return!1;return!0},each:function(t){for(var e in this)e[0]===u&&t(this[e],e.slice(1),this)}};var p=h;function d(){var t,e,n,s=[],o=[];function i(n,o,a,r){if(o>=s.length)return null!=t&&n.sort(t),null!=e?e(n):n;for(var l,u,c,h=-1,d=n.length,f=s[o++],g=p(),v=a();++h<d;)(c=g.get(l=f(u=n[h])+""))?c.push(u):g.set(l,[u]);return g.each((function(t,e){r(v,e,i(t,o,a,r))})),v}function a(t,n){if(++n>s.length)return t;var i,r=o[n-1];return null!=e&&n>=s.length?i=t.entries():(i=[],t.each((function(t,e){i.push({key:e,values:a(t,n)})}))),null!=r?i.sort((function(t,e){return r(t.key,e.key)})):i}return n={object:function(t){return i(t,0,f,g)},map:function(t){return i(t,0,v,b)},entries:function(t){return a(i(t,0,v,b),0)},key:function(t){return s.push(t),n},sortKeys:function(t){return o[s.length-1]=t,n},sortValues:function(e){return t=e,n},rollup:function(t){return e=t,n}}}function f(){return{}}function g(t,e,n){t[e]=n}function v(){return p()}function b(t,e,n){t.set(e,n)}function x(){}var m=p.prototype;function y(t,e){var n=new x;if(t instanceof x)t.each((function(t){n.add(t)}));else if(t){var s=-1,o=t.length;if(null==e)for(;++s<o;)n.add(t[s]);else for(;++s<o;)n.add(e(t[s],s,t))}return n}x.prototype=y.prototype={constructor:x,has:m.has,add:function(t){return this[u+(t+="")]=t,this},remove:m.remove,clear:m.clear,values:m.keys,size:m.size,empty:m.empty,each:m.each};var w=n(80066),$=n(77126),_=n(45902),S=n(50352),T=n(42274),M=n(3839),k=n(14827),Z=n(40565),E=n(92992),G=n(69607),I=n(79479);function O(t){return function(){return t}}function D(t,e,n){this.target=t,this.type=e,this.selection=n}function A(){T.B.stopImmediatePropagation()}function C(){T.B.preventDefault(),T.B.stopImmediatePropagation()}var z={name:"drag"},B={name:"space"},P={name:"handle"},V={name:"center"};function j(t){return[+t[0],+t[1]]}function q(t){return[j(t[0]),j(t[1])]}function R(t){return function(e){return(0,E.Z)(e,T.B.touches,t)}}var L={name:"x",handles:["w","e"].map(J),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},F={name:"y",handles:["n","s"].map(J),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},N={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(J),input:function(t){return null==t?null:q(t)},output:function(t){return t}},Y={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},W={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},X={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},H={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},K={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function J(t){return{type:t}}function U(){return!T.B.ctrlKey&&!T.B.button}function Q(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function tt(){return navigator.maxTouchPoints||"ontouchstart"in this}function et(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function nt(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function st(t){var e,n=Q,s=U,o=tt,i=!0,a=(0,M.Z)("start","brush","end"),l=6;function u(e){var n=e.property("__brush",v).selectAll(".overlay").data([J("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Y.overlay).merge(n).each((function(){var t=et(this).extent;(0,r.Z)(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),e.selectAll(".selection").data([J("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Y.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=e.selectAll(".handle").data(t.handles,(function(t){return t.type}));s.exit().remove(),s.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return Y[t.type]})),e.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(o).on("touchstart.brush",d).on("touchmove.brush",f).on("touchend.brush touchcancel.brush",g).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function c(){var t=(0,r.Z)(this),e=et(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-l/2:e[0][0]-l/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-l/2:e[0][1]-l/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+l:l})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+l:l}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function h(t,e,n){var s=t.__brush.emitter;return!s||n&&s.clean?new p(t,e,n):s}function p(t,e,n){this.that=t,this.args=e,this.state=t.__brush,this.active=0,this.clean=n}function d(){if((!e||T.B.touches)&&s.apply(this,arguments)){var n,o,a,l,u,p,d,f,g,v,b,x=this,m=T.B.target.__data__.type,y="selection"===(i&&T.B.metaKey?m="overlay":m)?z:i&&T.B.altKey?V:P,w=t===F?null:H[m],$=t===L?null:K[m],_=et(x),S=_.extent,M=_.selection,Z=S[0][0],E=S[0][1],O=S[1][0],D=S[1][1],j=0,q=0,N=w&&$&&i&&T.B.shiftKey,J=T.B.touches?R(T.B.changedTouches[0].identifier):G.Z,U=J(x),Q=U,tt=h(x,arguments,!0).beforestart();"overlay"===m?(M&&(g=!0),_.selection=M=[[n=t===F?Z:U[0],a=t===L?E:U[1]],[u=t===F?O:n,d=t===L?D:a]]):(n=M[0][0],a=M[0][1],u=M[1][0],d=M[1][1]),o=n,l=a,p=u,f=d;var st=(0,r.Z)(x).attr("pointer-events","none"),ot=st.selectAll(".overlay").attr("cursor",Y[m]);if(T.B.touches)tt.moved=at,tt.ended=lt;else{var it=(0,r.Z)(T.B.view).on("mousemove.brush",at,!0).on("mouseup.brush",lt,!0);i&&it.on("keydown.brush",ut,!0).on("keyup.brush",ct,!0),(0,k.Z)(T.B.view)}A(),(0,I.e1)(x),c.call(x),tt.start()}function at(){var t=J(x);!N||v||b||(Math.abs(t[0]-Q[0])>Math.abs(t[1]-Q[1])?b=!0:v=!0),Q=t,g=!0,C(),rt()}function rt(){var t;switch(j=Q[0]-U[0],q=Q[1]-U[1],y){case B:case z:w&&(j=Math.max(Z-n,Math.min(O-u,j)),o=n+j,p=u+j),$&&(q=Math.max(E-a,Math.min(D-d,q)),l=a+q,f=d+q);break;case P:w<0?(j=Math.max(Z-n,Math.min(O-n,j)),o=n+j,p=u):w>0&&(j=Math.max(Z-u,Math.min(O-u,j)),o=n,p=u+j),$<0?(q=Math.max(E-a,Math.min(D-a,q)),l=a+q,f=d):$>0&&(q=Math.max(E-d,Math.min(D-d,q)),l=a,f=d+q);break;case V:w&&(o=Math.max(Z,Math.min(O,n-j*w)),p=Math.max(Z,Math.min(O,u+j*w))),$&&(l=Math.max(E,Math.min(D,a-q*$)),f=Math.max(E,Math.min(D,d+q*$)))}p<o&&(w*=-1,t=n,n=u,u=t,t=o,o=p,p=t,m in W&&ot.attr("cursor",Y[m=W[m]])),f<l&&($*=-1,t=a,a=d,d=t,t=l,l=f,f=t,m in X&&ot.attr("cursor",Y[m=X[m]])),_.selection&&(M=_.selection),v&&(o=M[0][0],p=M[1][0]),b&&(l=M[0][1],f=M[1][1]),M[0][0]===o&&M[0][1]===l&&M[1][0]===p&&M[1][1]===f||(_.selection=[[o,l],[p,f]],c.call(x),tt.brush())}function lt(){if(A(),T.B.touches){if(T.B.touches.length)return;e&&clearTimeout(e),e=setTimeout((function(){e=null}),500)}else(0,k.D)(T.B.view,g),it.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);st.attr("pointer-events","all"),ot.attr("cursor",Y.overlay),_.selection&&(M=_.selection),nt(M)&&(_.selection=null,c.call(x)),tt.end()}function ut(){switch(T.B.keyCode){case 16:N=w&&$;break;case 18:y===P&&(w&&(u=p-j*w,n=o+j*w),$&&(d=f-q*$,a=l+q*$),y=V,rt());break;case 32:y!==P&&y!==V||(w<0?u=p-j:w>0&&(n=o-j),$<0?d=f-q:$>0&&(a=l-q),y=B,ot.attr("cursor",Y.selection),rt());break;default:return}C()}function ct(){switch(T.B.keyCode){case 16:N&&(v=b=N=!1,rt());break;case 18:y===V&&(w<0?u=p:w>0&&(n=o),$<0?d=f:$>0&&(a=l),y=P,rt());break;case 32:y===B&&(T.B.altKey?(w&&(u=p-j*w,n=o+j*w),$&&(d=f-q*$,a=l+q*$),y=V):(w<0?u=p:w>0&&(n=o),$<0?d=f:$>0&&(a=l),y=P),ot.attr("cursor",Y[m]),rt());break;default:return}C()}}function f(){h(this,arguments).moved()}function g(){h(this,arguments).ended()}function v(){var e=this.__brush||{selection:null};return e.extent=q(n.apply(this,arguments)),e.dim=t,e}return u.move=function(e,n){e.selection?e.on("start.brush",(function(){h(this,arguments).beforestart().start()})).on("interrupt.brush end.brush",(function(){h(this,arguments).end()})).tween("brush",(function(){var e=this,s=e.__brush,o=h(e,arguments),i=s.selection,a=t.input("function"==typeof n?n.apply(this,arguments):n,s.extent),r=(0,Z.Z)(i,a);function l(t){s.selection=1===t&&null===a?null:r(t),c.call(e),o.brush()}return null!==i&&null!==a?l:l(1)})):e.each((function(){var e=this,s=arguments,o=e.__brush,i=t.input("function"==typeof n?n.apply(e,s):n,o.extent),a=h(e,s).beforestart();(0,I.e1)(e),o.selection=null===i?null:i,c.call(e),a.start().brush().end()}))},u.clear=function(t){u.move(t,null)},p.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(e){(0,T._H)(new D(u,e,t.output(this.state.selection)),a.apply,a,[e,this.that,this.args])}},u.extent=function(t){return arguments.length?(n="function"==typeof t?t:O(q(t)),u):n},u.filter=function(t){return arguments.length?(s="function"==typeof t?t:O(!!t),u):s},u.touchable=function(t){return arguments.length?(o="function"==typeof t?t:O(!!t),u):o},u.handleSize=function(t){return arguments.length?(l=+t,u):l},u.keyModifiers=function(t){return arguments.length?(i=!!t,u):i},u.on=function(){var t=a.on.apply(a,arguments);return t===a?u:t},u}function ot(){return Math.random()}(function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,1===arguments.length?(n=t,t=0):n-=t,function(){return e()*n+t}}return n.source=t,n})(ot);var it=function t(e){function n(t,n){var s,o;return t=null==t?0:+t,n=null==n?1:+n,function(){var i;if(null!=s)i=s,s=null;else do{s=2*e()-1,i=2*e()-1,o=s*s+i*i}while(!o||o>1);return t+n*i*Math.sqrt(-2*Math.log(o)/o)}}return n.source=t,n}(ot),at=(function t(e){function n(){var t=it.source(e).apply(this,arguments);return function(){return Math.exp(t())}}return n.source=t,n}(ot),function t(e){function n(t){return function(){for(var n=0,s=0;s<t;++s)n+=e();return n}}return n.source=t,n}(ot));(function t(e){function n(t){var n=at.source(e)(t);return function(){return n()/t}}return n.source=t,n})(ot),function t(e){function n(t){return function(){return-Math.log(1-e())/t}}return n.source=t,n}(ot);const rt=function(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)},lt=function(t){let e=((0,i.VR)(t,.75)-(0,i.VR)(t,.25))/1.34;return 1.06*Math.min((0,i.P3)(t),e)*Math.pow(t.length,-.2)};var ut=n(1300),ct=n(6939);function ht(t){for(var e="",n=document.styleSheets,s=0;s<n.length;s++)try{if(null==n[s].cssRules)continue;for(var o=n[s].cssRules,i=0;i<o.length;i++){var a=o[i];if(void 0!==a.style){var r,l=void 0===a.selectorText?a.selectorText:a.selectorText.replace(`#${t[0].id} `,"");try{r=ct(t).find(l)}catch(t){r=[]}r.length>0&&(e+=a.selectorText+" { "+a.style.cssText+" }\n")}}}catch(t){if("SecurityError"!==t.name)throw t;continue}var u=document.createElement("style");return u.setAttribute("type","text/css"),u.innerHTML="<![CDATA[\n"+e+"\n]]>",u}var pt=n(6939);class dt{constructor(t,e,n=!1){pt(`#${t}`).show();const s=n?"btn-group-vertical btn-group-sm":"btn-group btn-group-sm";this.bar=pt("<div/>").addClass(s).appendTo(`#${t}`),this.buttons={},this.tooltip=e}createDownloadSvgButton(t,e,n,s,o="fa-download"){this.createButton(t,o);(0,r.Z)(`#${t}`).on("click",(()=>{this.downloadSvg(e,n,s)})).on("mouseover",(()=>{this.tooltip.show("Download")})).on("mouseout",(()=>{this.tooltip.hide()}))}createResetButton(t,e,n="fa-expand-arrows-alt"){this.createButton(t,n);(0,r.Z)(`#${t}`).on("click",e).on("mouseover",(()=>{this.tooltip.show("Reset the scales")})).on("mouseout",(()=>{this.tooltip.hide()}))}createButton(t,e="fa-download"){const n=pt("<a/>").attr("id",t).addClass("btn btn-default").appendTo(this.bar);return pt("<i/>").addClass(`fa ${e}`).appendTo(n),this.buttons[t]=n,n}attachTooltip(t){this.tooltip=t}downloadSvg(t,e,n){let s=pt(pt(pt(""+("#"+t)))[0]),o=s.clone().attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg"),i=ht(s.get());o.prepend(i),pt("#"+n).html("").hide();let a=pt(`#${n}`).append(o).html(),r=new Blob([a],{type:"image/svg+xml"});saveAs(r,e),pt(`#${n}`).html("").hide()}}var ft=n(6939);class gt{constructor(t,e={}){this._sanityCheck(t),this.data=t,this.groupInfo=e,this.toolbar=void 0,this.tooltip=void 0}render(t,e=500,n=357,s=.05,o,a=[-3,3],l="Y axis",u=!0,c=30,h=!0,p=0,f=!1,g=!1,v=!1,b=!1,x=!1,m=!1,y=0){if(this.reset=()=>{t.selectAll("*").remove(),this.render(t,e,n,s,o,a,l,u,c,h,p,f,g,v,b,x,m)},this.updateYScale=function(i,a){t.selectAll("*").remove(),void 0===a&&(a=[]),this.render(t,e,n,s,o,[],i,u,c,h,p,f,g,v,b,x,m)},this.updateXScale=function(o){void 0===o&&console.error("updateXScale called without new X domain"),t.selectAll("*").remove(),this.render(t,e,n,s,o,[],l,u,c,h,p,f,g,v,b,x,m)},void 0===a||0==a.length){let t=[];this.data.forEach((e=>t=t.concat(e.values))),a=(0,i.We)(t)}this.groups=d().key((t=>t.group)).entries(this.data),this.scale={x:(0,w.Z)().rangeRound([0,e]).domain(o||this.groups.map((t=>t.key))).paddingInner(s),subx:(0,w.Z)(),y:(0,$.Z)().rangeRound([n,0]).domain(a),z:(0,$.Z)()},this.groups.forEach((e=>{let s=e.key,o=e.values,r=this.groupInfo[s];if(e.index=this.scale.x.domain().indexOf(s),void 0!==r){t.append("g").selectAll(".violin-group-label").data(["pvalue"]).enter().append("text").attr("x",0).attr("y",0).attr("class","violin-group-label").attr("text-anchor","center").attr("fill",(t=>"pvalue"==t&&parseFloat(r[t])<=parseFloat(r.pvalueThreshold)?"orangered":"SlateGray")).attr("transform",((t,e)=>`translate(${this.scale.x(s)+this.scale.x.bandwidth()/2}, ${this.scale.y(a[0])+50})`)).text((t=>`${t}: ${parseFloat(parseFloat(r[t]).toPrecision(3)).toExponential()}`))}x&&o.sort(((t,e)=>t.label<e.label?-1:t.label>e.label?1:0)),this.scale.subx.domain(o.map((t=>t.label))).rangeRound([this.scale.x(s),this.scale.x(s)+this.scale.x.bandwidth()]),o.forEach((n=>{0!=n.values.length&&(n.values=n.values.sort(i.j2),this._drawViolin(t,n,f,e.index,m,y))}));var l=18;if(b){const e=(0,w.Z)().domain(o.map((t=>null==t.size?"(0)":`(${t.size||0})`))).rangeRound([this.scale.x(s),this.scale.x(s)+this.scale.x.bandwidth()]);t.append("g").attr("class","violin-size-axis").attr("transform",`translate(0, ${n+l})`).call((0,S.LL)(e))}if(h){l=5;const e=t.append("g").attr("class","violin-sub-axis").attr("transform",`translate(0, ${n+l})`).call((0,S.LL)(this.scale.subx));p>0&&e.selectAll("text").attr("text-anchor","start").attr("transform",`rotate(${p}, 2, 10)`)}}));let _=h?55:0;if(this.xAxis=u?(0,S.LL)(this.scale.x):(0,S.LL)(this.scale.x).tickFormat(""),t.append("g").attr("class","violin-x-axis axis--x").attr("transform",`translate(0, ${n+_})`).call(this.xAxis).selectAll("text").attr("text-anchor","start").attr("transform",`rotate(${c}, -10, 10)`),_=5,this.yAxis=(0,S.y4)(this.scale.y).tickValues(this.scale.y.ticks(5)),t.append("g").attr("class","violin-y-axis axis--y").attr("transform",`translate(-${_}, 0)`).call(this.yAxis),t.append("text").attr("class","violin-axis-label").attr("text-anchor","middle").attr("transform",`translate(-${2*_+(0,r.Z)(".violin-y-axis").node().getBBox().width}, ${this.scale.y.range()[0]+(this.scale.y.range()[1]-this.scale.y.range()[0])/2}) rotate(-90)`).text(l),t.on("mouseout",(()=>{void 0!==this.tooltip&&this.tooltip.hide()})),g&&this._addGroupDivider(t),v){const e=t.append("g").attr("id","violinLegend").attr("transform","translate(0, 0)");e.append("rect").attr("x",this.scale.x.range()[0]).attr("y",-35).attr("width",60*this.groups[0].values.length+10).attr("height",24).style("fill","none").style("stroke","silver");const n=e.selectAll(".violin-legend").data(this.groups[0].values).enter().append("g").classed("violin-legend",!0),s=10;n.append("rect").attr("x",((t,e)=>5+60*e+this.scale.x.range()[0])).attr("y",-28).attr("width",s).attr("height",s).style("fill",(t=>t.color)),n.append("text").attr("class","violin-legend-text").text((t=>t.label)).attr("x",((t,e)=>17+60*e+this.scale.x.range()[0])).attr("y",-20)}}addPlotTitle(t,e){let n=(this.scale.x.range()[1]-this.scale.x.range()[0]+1)/2,s=this.scale.y.range()[1]-10;t.append("text").attr("class","violin-title").attr("text-anchor","middle").attr("transform",`translate(${n}, ${s})`).text(e)}createTooltip(t){return 0==ft(`#${t}`).length&&ft("<div/>").attr("id",t).appendTo(ft("body")),this.tooltip=new ut.Z(t),(0,r.Z)(`#${t}`).classed("violin-tooltip",!0),this.tooltip}createToolbar(t,e){return this.toolbar=new dt(t,e),this.toolbar}addBrush(t){const e=st(N);e.on("end",(()=>{this.zoom(t,e)})),t.append("g").attr("class","brush").call(e)}zoom(t,e){let n,s=T.B.selection;if(void 0===e)this.reset();else if(s){this.scale.x.domain(this.scale.x.domain().filter(((t,e)=>{const n=Math.floor(s[0][0]/this.scale.x.bandwidth()),o=Math.floor(s[1][0]/this.scale.x.bandwidth());return e>=n&&e<=o})));const n=Math.floor(this.scale.y.invert(s[1][1])),o=Math.floor(this.scale.y.invert(s[0][1]));this.scale.y.domain([n,o]),t.select(".brush").call(e.move,null)}else{if(!n)return n=setTimeout((function(){n=null}),350);this.reset()}let o=t.transition().duration(750);t.select(".axis--x").transition(o).call(this.xAxis),t.select(".axis--y").transition(o).call(this.yAxis),this.groups.forEach(((e,n)=>{let s=e.key,a=e.values;this.scale.subx.rangeRound([this.scale.x(s),this.scale.x(s)+this.scale.x.bandwidth()]),a.forEach((n=>{if(0==n.values.length)return;this.scale.x.domain().indexOf(s);this.scale.z.range([this.scale.subx(n.label),this.scale.subx(n.label)+this.scale.subx.bandwidth()]);const a=t.select(`#violin${e.index}-${n.label}`);a.select(".violin").transition(o).attr("d",(0,_.Z)().x0((t=>this.scale.z(t[1]))).x1((t=>this.scale.z(-t[1]))).y((t=>this.scale.y(t[0]))));const r=(0,i.VR)(n.values,.25),l=(0,i.VR)(n.values,.75),u=.1;a.select(".violin-ir").transition(o).attr("x",this.scale.z(-u)).attr("y",this.scale.y(l)).attr("width",Math.abs(this.scale.z(-u)-this.scale.z(u))).attr("height",Math.abs(this.scale.y(l)-this.scale.y(r)));const c=(0,i.C2)(n.values);a.select(".violin-median").transition(o).attr("x1",this.scale.z(-u)).attr("x2",this.scale.z(u)).attr("y1",this.scale.y(c)).attr("y2",this.scale.y(c))}))}))}_drawViolin(t,e,n,s,o,a){let r=function(t,e,n){return function(s){return e.map((e=>[e,(0,i.J6)(s,(s=>t((e-s)/n)))/n]))}}(rt,this.scale.y.ticks(100),lt(e.values));const l=(0,i.We)(e.values),u=r(e.values).filter((t=>t[0]>=l[0]&&t[0]<=l[1])),c=t.append("g").attr("id",`violin${s}-${e.label}`).attr("class","violin-g").datum(e);if(e.values.length>=a&&u.length&&this._validVertices(u)){let a=(0,i.Fp)(u,(t=>Math.abs(t[1])));this.scale.z.domain([-a,a]).range([this.scale.subx(e.label),this.scale.subx(e.label)+this.scale.subx.bandwidth()]);let r=(0,_.Z)().x0((t=>this.scale.z(t[1]))).x1((t=>this.scale.z(-t[1]))).y((t=>this.scale.y(t[0])));const l=c.append("path").datum(u).attr("d",r).classed("violin",!0).style("fill",(()=>void 0!==e.color?e.color:s%2==0?"#90c1c1":"#94a8b8")),h=(0,i.VR)(e.values,.25),p=(0,i.VR)(e.values,.75),d=this.scale.z.domain()[1]/3;if(n){const n=Math.abs(p-h),s=(0,i.Fp)(e.values.filter((t=>t<=p+1.5*n))),o=(0,i.VV)(e.values.filter((t=>t>=h-1.5*n)));t.append("line").classed("whisker",!0).attr("x1",this.scale.z(0)).attr("x2",this.scale.z(0)).attr("y1",this.scale.y(s)).attr("y2",this.scale.y(o)).style("stroke","#fff")}c.append("rect").attr("x",this.scale.z(-d)).attr("y",this.scale.y(p)).attr("width",Math.abs(this.scale.z(-d)-this.scale.z(d))).attr("height",Math.abs(this.scale.y(p)-this.scale.y(h))).attr("class","violin-ir");const f=(0,i.C2)(e.values);if(c.append("line").attr("x1",this.scale.z(-d)).attr("x2",this.scale.z(d)).attr("y1",this.scale.y(f)).attr("y2",this.scale.y(f)).attr("class","violin-median"),o){let t=it(0,d/2);const n=Math.abs(p-h),s=(0,i.Fp)(e.values.filter((t=>t<=p+1.5*n))),o=(0,i.VV)(e.values.filter((t=>t>=h-1.5*n))),a=e.values.filter((t=>t<o||t>s));c.append("g").attr("class","violin-outliers").selectAll("circle").data(a).enter().append("circle").attr("cx",(()=>this.scale.z(t()))).attr("cy",(t=>this.scale.y(t))).attr("r",2)}c.on("mouseover",(()=>{l.classed("highlighted",!0),void 0===this.tooltip?console.warn("GroupViolin Warning: tooltip not defined"):this.tooltip.show(e.group+"<br/>"+e.label+"<br/>Median: "+f.toPrecision(4)+"<br/>")})),c.on("mouseout",(()=>{l.classed("highlighted",!1)}))}else if(a){let t=(0,i.Fp)(e.values,(t=>Math.abs(t)));this.scale.z.domain([-t,t]).range([this.scale.subx(e.label),this.scale.subx(e.label)+this.scale.subx.bandwidth()]);const n=this.scale.z.domain()[1]/3;let s=it(0,n/2);c.append("g").attr("class","violin-points").selectAll("circle").data(e.values).enter().append("circle").attr("cx",(()=>this.scale.z(s()))).attr("cy",(t=>this.scale.y(t))).attr("r",2)}}_sanityCheck(t){const e=["group","label","values"];t.forEach((t=>{e.forEach((e=>{if(void 0===t[e])throw"GroupedViolin: input data error."}))}))}_addGroupDivider(t){const e=this.scale.x.domain(),n=Math.abs(this.scale.x(this.scale.x.domain()[1])-this.scale.x(this.scale.x.domain()[0])-this.scale.x.bandwidth()),s=(t,s)=>s!==e.length-1?this.scale.x(t)+ +this.scale.x.bandwidth()+n/2:0;t.selectAll(".vline").data(e).enter().append("line").classed("vline",!0).attr("x1",s).attr("x2",s).attr("y1",this.scale.y.range()[0]).attr("y2",this.scale.y.range()[1]).style("stroke-width",((t,n)=>n!=e.length-1?1:0)).style("stroke","rgb(86,98,107)").style("opacity",.5)}_validVertices(t){return!t.reduce(((t,e)=>t.concat(e)),[]).filter((t=>isNaN(t))).length}}var vt=n(6939);function bt(t,e,n,s="Gene Expression Violin Plot",u=function(){const t="https://gtexportal.org/rest/v1/";return{singleTissueEqtl:t+"association/singleTissueEqtl?format=json&datasetId=gtex_v7&gencodeId=",ld:t+"dataset/ld?format=json&datasetId=gtex_v7&gencodeId=",dyneqtl:t+"association/dyneqtl",snp:t+"reference/variant?format=json&snpId=",variantId:t+"dataset/variant?format=json&variantId=",exonExp:t+"expression/medianExonExpression?datasetId=gtex_v7&hcluster=true&gencodeId=",transcriptExp:t+"expression/medianTranscriptExpression?datasetId=gtex_v7&hcluster=true&gencodeId=",junctionExp:t+"expression/medianJunctionExpression?datasetId=gtex_v7&hcluster=true&gencodeId=",transcript:t+"reference/transcript?datasetId=gtex_v7&gencodeId=",exon:t+"reference/exon?datasetId=gtex_v7&gencodeId=",geneModel:t+"dataset/collapsedGeneModelExon?datasetId=gtex_v7&gencodeId=",geneModelUnfiltered:t+"dataset/fullCollapsedGeneModelExon?datasetId=gtex_v7&gencodeId=",geneExp:t+"expression/geneExpression?datasetId=gtex_v7&gencodeId=",medGeneExp:t+"expression/medianGeneExpression?datasetId=gtex_v7&hcluster=true&pageSize=10000",geneExpBoxplot:t+"expression/geneExpression?datasetId=gtex_v7&boxplotDetail=full&gencodeId=",topInTissueFiltered:t+"expression/topExpressedGene?datasetId=gtex_v7&filterMtGene=true&sortBy=median&sortDirection=desc&pageSize=50&tissueSiteDetailId=",topInTissue:t+"expression/topExpressedGene?datasetId=gtex_v7&sortBy=median&sortDirection=desc&pageSize=50&tissueSiteDetailId=",geneId:t+"reference/gene?format=json&gencodeVersion=v19&genomeBuild=GRCh37%2Fhg19&geneId=",tissue:t+"dataset/tissueInfo?format=json&datasetId=gtex_v7",sample:"tmpSummaryData/gtex.Sample.csv",rnaseqCram:"tmpSummaryData/rnaseq_cram_files_v7_dbGaP_011516.txt",wgsCram:"tmpSummaryData/wgs_cram_files_v7_hg38_dbGaP_011516.txt",fcBilling:"https://api.firecloud.org/api/profile/billing",fcWorkSpace:"https://api.firecloud.org/api/workspaces",fcPortalWorkSpace:"https://portal.firecloud.org/#workspaces"}}(),c=xt(50,75,250,60),h={w:.8*window.innerWidth,h:250}){const p=[o(u.tissue,{credentials:"include"}),o(u.geneExp+n,{credentials:"include"}),o(u.geneExp+n+"&attributeSubset=sex",{credentials:"include"})],d={root:t,spinner:"spinner",svg:`${t}-svg`,tooltip:e,toolbar:`${t}-toolbar`,clone:`${t}-svg-clone`,buttons:{download:`${t}-download`,plotOptions:`${t}-option-modal`,filter:`${t}-filter`,ascAlphaSort:`${t}-asc-alphasort`,descAlphaSort:`${t}-desc-alphasort`,ascSort:`${t}-asc-sort`,descSort:`${t}-desc-sort`,logScale:`${t}-log-scale`,linearScale:`${t}-linear-scale`,noDiff:`${t}-no-diff`,sexDiff:`${t}-sex-diff`,outliersOn:`${t}-outliers-on`,outliersOff:`${t}-outliers-off`},plotOptionGroups:{scale:`${t}-option-scale`,sort:`${t}-option-sort`,differentiation:`${t}-option-differentiation`,outliers:`${t}-option-outlier`},plotSorts:{ascAlphaSort:"asc-alphasort",descAlphaSort:"desc-alphasort",ascSort:"asc-sort",descSort:"desc-sort"},tissueFilter:`${t}-filter-modal`};if(0==vt(`#${d.root}`).length)throw"Violin Plot Error: rootId does not exist.";0==vt(`#${d.tooltip}`).length&&vt("<div/>").attr("id",d.tooltip).appendTo(vt("body")),0==vt(`#${d.toolbar}`).length&&vt("<div/>").attr("id",d.toolbar).appendTo(vt(`#${d.root}`)),0==vt(`#${d.root} #${d.spinner}`).length?vt('<span><i id="spinner" class="fas fa-sync fa-spin"></i></span>').appendTo(vt(`#${d.root}`)):vt(`#${d.root} #${d.spinner}`).show(),0==vt(`#${d.clone}`).length&&vt("<div/>").attr("id",d.clone).appendTo(vt(`#${d.root}`)),Promise.all(p).then((function(t){const e=function(t){const e="tissueInfo";if(!t.hasOwnProperty(e))throw"Parsing Error: required json attr is missing: "+e;const n=t[e];return["tissueSiteDetailId","tissueSiteDetail","colorHex"].forEach((t=>{if(!n[0].hasOwnProperty(t))throw"Parsing Error: required json attr is missing: "+t})),n}(t[0]),o={},u={},p={female:"#e67f7b",male:"#70bcd2"};e.forEach((t=>{u[t.tissueSiteDetailId]=t.tissueSiteDetail,o[t.tissueSiteDetail]=t,p[t.tissueSiteDetailId]=t.colorHex}));const f=yt(t[1],u,p,!1);if(!f.length)return vt(`#${d.toolbar}`).remove(),vt(`<div id="gene-exp-vplot">No gene expression data found for ${n}</div>`).appendTo(`#${d.root}`),void vt(`#${d.root} #${d.spinner}`).hide();let g=new gt(f),v=g.createTooltip(d.tooltip);g.sortData=g.data.map((t=>t)),g.allData=g.data.map((t=>t)),g.gencodeId=n,g.tIdNameMap=u,g.groupColorDict=p,g.tissueDict=o,g.geneJson={allData:t[1],subsetData:t[2]},g.unit=f.length>0?` ${f[0].unit}`:"",g.gpConfig={subset:!1,scale:"linear",sort:d.plotSorts.ascAlphaSort,showOutliers:!0,title:s},function(t,e,n,s){const o=e,i=function(t=1200,e=250,n=xt()){return{width:t,height:e,outerWidth:t+(n.left+n.right),outerHeight:e+(n.top+n.bottom)}}(n.w,n.h,o),a=(0,r.Z)(`#${s.root}`).append("svg").attr("id",s.svg).attr("width",i.outerWidth).attr("height",i.outerHeight).append("g").attr("transform",`translate(${o.left}, ${o.top})`),l=i.width,u=i.height,c=.2,h=St(t.gpConfig.sort,t.sortData,s),p=[],d="TPM",f=!0,g=35,v=!1,b=0,x=!1,m=!1,y=!0,w=!1,$=!0,_=!0;t.render(a,l,u,c,h,p,d,f,g,v,b,x,m,y,w,$,_),$t(t,s)}(g,c,h,d),function(t,e,n,s){const o=function(t,e=!1){const n=["Bladder","Cervix_Ectocervix","Cervix_Endocervix","Fallopian_Tube","Kidney_Cortex"],s="tissueInfo";if(!t.hasOwnProperty(s))throw"Parsing Error: required json attribute is missing: "+s;let o=t[s];["tissueSite","tissueSiteDetailId","tissueSiteDetail"].forEach((t=>{if(!o[0].hasOwnProperty(t))throw`parseTissueSites attr error. ${t} is not found`})),o=0==e?o:o.filter((t=>!n.includes(t.tissueSiteDetailId)));let i=o.reduce(((t,e)=>{let n=e.tissueSite,s={id:e.tissueSiteDetailId,name:e.tissueSiteDetail};return t.hasOwnProperty(n)||(t[n]=[]),t[n].push(s),t}),{});return Object.keys(i).forEach((t=>{if(1==i[t].length){let e=i[t][0];delete i[t],i[e.name]=[e]}})),i}(s);(function(t,e,n=!1,s=!1,o=4){const a="tissue-group-main-level";(0,r.Z)(`#${e}`).selectAll("*").remove();const u=l("<div/>").attr("class","col-xs-12 col-md-12").appendTo(l(`#${e}`));n?l(`<label class=${a}><input type="radio" name="allTissues" value="reset"> Reset </label><br/>`).appendTo(u):l(`<label class=${a}><input type="radio" name="allTissues" value="all"> All </label> <label class=${a}><input type="radio" name="allTissues" value="reset"> Reset </label><br/>`).appendTo(u),l('input[name="allTissues"]').change((function(){switch(l(this).val()){case"all":l(".tissueGroup").prop("checked",!0),l(".tissueSubGroup").prop("checked",!0);break;case"reset":l(".tissueGroup").prop("checked",!1),l(".tissueSubGroup").prop("checked",!1)}}));let c=Object.keys(t).sort(((t,e)=>"Brain"==t?-1:"Brain"==e?1:t<e?-1:t>e?1:void 0)),h=Object.keys(t).reduce(((e,n)=>t[n].length>1?e+1+t[n].length:e+t[n].length),0),p=Math.ceil(h/o),d=h%o,f=Math.floor(12/o);const g=(0,i.w6)(0,o).map((t=>l(`<div id="section${t}" class="col-xs-12 col-md-${f}">`).appendTo(l(`#${e}`))));let v=0,b=0;c.forEach((e=>{let n=t[e];const s=e.replace(/ /g,"_");let o=n.length;o=1==o?o:o+1,0!=v&&o+v>p+d&&(v=0,b+=1),v+=o;let i=g[b];l(`<label class=${a}><input type="checkbox" id="${s}" class="tissueGroup"> <span>${e}</span></label><br/>`).appendTo(i),n.length>1&&n.sort(((t,e)=>t.id>e.id?1:t.id<e.id?-1:0)).forEach((function(t,e){let s=l(`<label class=tissue-group-sub-level><input type="checkbox" id="${t.id}" class="tissueSubGroup"> <span>${t.name}</span></label><br/>`).appendTo(i);e==n.length-1&&s.addClass("last-site"),s.click((function(){l('input[name="allTissues"]').prop("checked",!1)}))})),l("#"+s).click((function(){l('input[name="allTissues"]').prop("checked",!1),l("#"+s).is(":checked")?n.forEach((function(t){"id"!=t.id&&l("#"+t.id).prop("checked",!0)})):n.forEach((function(t){"id"!=t.id&&l("#"+t.id).prop("checked",!1)}))}))})),s&&(l('input[name="allTissues"][value="all"]').prop("checked",!0),l(".tissueGroup").prop("checked",!0),l(".tissueSubGroup").prop("checked",!0))})(o,`${e}-body`,!1,!0,3),function(t,e,n,s){vt(`#${e}`).on("hidden.bs.modal",(o=>{let i=function(t,e,n=!1){let s=[];return l(`#${e}`).find(":input").each((function(){if(l(this).is(":checked")){const e=l(this).attr("id");if(l(this).hasClass("tissueGroup")){let o=e.replace(/_/g," ");1==t[o].length&&(n?s.push(t[o][0].name):s.push(t[o][0].id))}else n?s.push(l(l(this).siblings()[0]).text()):s.push(e)}})),s.filter((t=>void 0!==t))}(s,`${e}-body`,!0);!function(t,e,n){let s=t.allData.filter((t=>n.includes(t.group)));t.data=s,Tt(t,e)}(t,n,i)}))}(t,e,n,o)}(g,d.tissueFilter,d,t[0]),function(t,e,n,s){let o=t.createToolbar(n.toolbar,e);o.createDownloadSvgButton(n.buttons.download,n.svg,"gene-exp-plot.svg",n.clone),vt(`#${n.toolbar}`).addClass("row"),vt(`#${n.toolbar} .btn-group`).addClass("col-xs-12 col-lg-1 text-nowrap").css("display","flex"),vt("<div></div>").appendTo(`#${n.toolbar}`).attr("id",`${n.toolbar}-plot-options`).attr("class","col-lg-11 text-nowrap");let i=vt(`#${n.toolbar}-plot-options`);vt("<div/>").appendTo(i).attr("id",n.plotOptionGroups.differentiation).attr("class","col-lg-2 col-xl-2"),vt("<span/>").appendTo(`#${n.plotOptionGroups.differentiation}`).attr("class",`${n.root}-option-label`).html("Subset"),vt("<div/>").appendTo(`#${n.plotOptionGroups.differentiation}`).attr("class","btn-group btn-group-sm");let l=vt(`#${n.plotOptionGroups.differentiation} .btn-group`);vt(`<button class="btn btn-default" id="${n.buttons.noDiff}">None</button>`).appendTo(l),vt(`<button class="btn btn-default" id="${n.buttons.sexDiff}">Sex</button>`).appendTo(l),vt("<div/>").appendTo(i).attr("id",n.plotOptionGroups.scale).attr("class","col-lg-2 col-xl-2"),vt("<span/>").appendTo(`#${n.plotOptionGroups.scale}`).attr("class",`${n.root}-option-label`).html("Scale"),vt("<div/>").appendTo(`#${n.plotOptionGroups.scale}`).attr("class","btn-group btn-group-sm");let u=vt(`#${n.plotOptionGroups.scale} .btn-group`);vt(`<button class="btn btn-default" id="${n.buttons.logScale}">Log</button>`).appendTo(u),vt(`<button class="btn btn-default" id="${n.buttons.linearScale}">Linear</button>`).appendTo(u),vt("<div/>").appendTo(i).attr("class",`${n.plotOptionGroups.sort} col-lg-2 col-xl-2`).attr("id","vplot-alpha-sorts"),vt("<span/>").appendTo(`.${n.plotOptionGroups.sort}#vplot-alpha-sorts`).attr("class",`${n.root}-option-label`).html("Tissue Sort"),vt("<div/>").appendTo(`.${n.plotOptionGroups.sort}#vplot-alpha-sorts`).attr("class","btn-group btn-group-sm").attr("id",`${n.plotOptionGroups.sort}-alpha`);let c=vt(`#${n.plotOptionGroups.sort}-alpha.btn-group`);vt(`<button class="btn btn-default fa fa-caret-up" id="${n.buttons.ascAlphaSort}"></button>`).appendTo(c),vt(`<button class="btn btn-default fa fa-caret-down" id="${n.buttons.descAlphaSort}"></button>`).appendTo(c),vt("<div/>").appendTo(i).attr("class",`${n.plotOptionGroups.sort} col-lg-2 col-xl-2`).attr("id","vplot-num-sorts"),vt("<span/>").appendTo(`.${n.plotOptionGroups.sort}#vplot-num-sorts`).attr("class",`${n.root}-option-label`).html("Median Sort"),vt("<div/>").appendTo(`.${n.plotOptionGroups.sort}#vplot-num-sorts`).attr("class","btn-group btn-group-sm").attr("id",`${n.plotOptionGroups.sort}-num`);let h=vt(`#${n.plotOptionGroups.sort}-num.btn-group`);vt(`<button class="btn btn-default fa fa-caret-up" id="${n.buttons.ascSort}"></button>`).appendTo(h),vt(`<button class="btn btn-default fa fa-caret-down" id="${n.buttons.descSort}"></button>`).appendTo(h),vt("<div/>").appendTo(i).attr("id",n.plotOptionGroups.outliers).attr("class","col-lg-2 col-xl-2"),vt("<span/>").appendTo(`#${n.plotOptionGroups.outliers}`).attr("class",`${n.root}-option-label`).html("Outliers"),vt("<div/>").appendTo(`#${n.plotOptionGroups.outliers}`).attr("class","btn-group btn-group-sm");let p=vt(`#${n.plotOptionGroups.outliers} .btn-group`);vt(`<button class="btn btn-default" id="${n.buttons.outliersOn}">On</button>`).appendTo(p),vt(`<button class="btn btn-default" id="${n.buttons.outliersOff}">Off</button>`).appendTo(p),(0,a.Z)(`#${n.plotOptionsModal} .modal-body button`).classed("active",!1),(0,a.Z)(`#${n.buttons.ascAlphaSort},\n               #${n.buttons.linearScale},\n               #${n.buttons.noDiff},\n               #${n.buttons.outliersOn}`).classed("active",!0),o.createButton(n.buttons.filter,"fa-filter"),(0,r.Z)(`#${n.buttons.filter}`).on("mouseover",(()=>{o.tooltip.show("Filter Tissues")})).on("mouseout",(()=>{o.tooltip.hide()})).on("click",((t,e,n)=>{vt("#gene-expr-vplot-filter-modal").modal("show")})),vt(`.${n.plotOptionGroups.sort} button`).on("click",(function(e){let s=(0,r.Z)(this);s.classed("active")||((0,a.Z)(`.${n.plotOptionGroups.sort} button`).classed("active",!1),s.classed("active",!0),t.gpConfig.sort=e.target.id.replace(`${n.root}-`,""),Tt(t,n))})),vt(`#${n.plotOptionGroups.scale} button`).on("click",(function(e){let s=(0,r.Z)(this);s.classed("active")||((0,a.Z)(`#${n.plotOptionGroups.scale} button`).classed("active",!1),s.classed("active",!0),t.gpConfig.scale=e.target.id==n.buttons.logScale?"log":"linear",Tt(t,n))})),vt(`#${n.plotOptionGroups.outliers} button`).on("click",(function(e){let s=(0,r.Z)(this);s.classed("active")||((0,a.Z)(`#${n.plotOptionGroups.outliers} button`).classed("active",!1),s.classed("active",!0),t.gpConfig.showOutliers=e.target.id==n.buttons.outliersOn,_t(t,n))})),vt(`#${n.plotOptionGroups.differentiation} button`).on("click",(function(e){let s=(0,r.Z)(this);s.classed("active")||((0,a.Z)(`#${n.plotOptionGroups.differentiation} button`).classed("active",!1),s.classed("active",!0),t.gpConfig.subset=e.target.id==n.buttons.sexDiff,Tt(t,n))}))}(g,v,d),vt(`#${d.root} #${d.spinner}`).hide()}))}function xt(t=50,e=50,n=50,s=50){return{top:t,right:e,bottom:n,left:s}}function mt(t,e=!0){t.forEach((t=>{t.values=e?t.data.map((t=>Math.log10(+t+1))):t.data,t.values.sort(i.j2),t.median=(0,i.C2)(t.values)}))}function yt(t,e,n,s=!0){const o="geneExpression";if(!t.hasOwnProperty(o))throw"Parse Error: required json attribute is missing: "+o;return t[o].forEach((t=>{["data","tissueSiteDetailId","geneSymbol","gencodeId"].forEach((e=>{if(!t.hasOwnProperty(e))throw console.error(t),"Parse Error: required json attribute is missing: "+e})),t.group=void 0===e?t.tissueSiteDetailId:e[t.tissueSiteDetailId],t.label=void 0===t.subsetGroup?t.geneSymbol:t.subsetGroup,t.color=void 0===n?"#90c1c1":void 0===t.subsetGroup?`#${n[t.tissueSiteDetailId]}`:n[t.subsetGroup]})),mt(t[o],s),t[o]}function wt(t){const e=t.select(".violin-x-axis");e.attr("transform",`${e.attr("transform")} translate(0, 3)`)}function $t(t,e){let n=(0,r.Z)(`#${e.svg} g`);void 0!==t.gpConfig.title&&t.addPlotTitle(n,t.gpConfig.title),_t(t,e),t.gpConfig.subset?function(t,e,n,s="top"){wt(e);const o=e.selectAll(".violin-x-axis text");o.attr("transform",`translate(0, 8) ${o.attr("transform")}`),e.append("g").selectAll(".tcolor").data(t.scale.x.domain()).enter().append("rect").classed("tcolor",!0).attr("x",(e=>t.scale.x(e))).attr("y",(e=>"top"==s?t.scale.y.range()[1]:t.scale.y.range()[0])).attr("transform","translate(0, 14)").attr("width",(e=>t.scale.x.bandwidth())).attr("height",5).style("stroke-width",0).style("fill",(t=>`#${n[t].colorHex}`)).style("opacity",.9)}(t,n,t.tissueDict,"bottom"):((0,r.Z)(`#${e.svg} #violinLegend`).remove(),wt(n)),function(t){(0,a.Z)(".violin-g").on("mouseover",((e,n,s)=>{let o="log"==t.gpConfig.scale?Math.pow(10,e.median)-1:e.median;(0,r.Z)(s[n]).select("path").classed("highlighted",!0),t.gpConfig.subset?t.tooltip.show(e.group+"<br/>"+e.label+` (n = ${e.values.length})<br/>`+`Median${t.unit}: ${o.toPrecision(4)}<br/>`):t.tooltip.show(e.group+"<br/>"+`n = ${e.values.length}<br/>`+`Median${t.unit}: ${o.toPrecision(4)}<br/>`)}))}(t)}function _t(t,e){(0,a.Z)(`#${e.svg} path.violin`).classed("outlined",!t.gpConfig.showOutliers),vt(`#${e.svg} .violin-outliers`).toggle(t.gpConfig.showOutliers)}function St(t,e,n){switch(t){case n.plotSorts.ascAlphaSort:e.sort(((t,e)=>t.group<e.group?-1:t.group>e.group?1:0));break;case n.plotSorts.descAlphaSort:e.sort(((t,e)=>t.group<e.group?1:t.group>e.group?-1:0));break;case n.plotSorts.ascSort:e.sort(((t,e)=>t.median-e.median));break;case n.plotSorts.descSort:e.sort(((t,e)=>e.median-t.median))}return e.map((t=>t.group))}function Tt(t,e){let n=t.gpConfig.subset?t.geneJson.subsetData:t.geneJson.allData;const s="log"==t.gpConfig.scale?yt(n,t.tIdNameMap,t.groupColorDict):yt(n,t.tIdNameMap,t.groupColorDict,!1);let o=t.data.map((t=>t.group));t.allData=s.map((t=>t)),t.data=s.filter((t=>-1!=o.indexOf(t.group)));let i=t.sortData.filter((t=>o.includes(t.group))),a=St(t.gpConfig.sort,i,e);mt(t.data,"log"==t.gpConfig.scale),mt(t.allData,"log"==t.gpConfig.scale);let r="log"==t.gpConfig.scale?"log10(TPM+1)":"TPM";t.updateXScale(a),t.updateYScale(r),$t(t,e)}}}]);